---
title: é£ä¹¦æ¨é€å™¨
parent: DailyPaper
nav_order: 5
layout: default
---

# Chapter 5: é£ä¹¦æ¨é€å™¨

åœ¨[ç¬¬å››ç« ](04_llmæ‘˜è¦ç”Ÿæˆå™¨_.md)ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•è®©AIæŠŠè®ºæ–‡"çƒ¹è°ƒ"æˆç¾å‘³çš„çŸ¥è¯†ç®€é¤ã€‚ç°åœ¨éœ€è¦ä¸€ä½å°½è´£çš„"å¤–å–éª‘å£«"ï¼ŒæŠŠè¿™äº›çŸ¥è¯†é€åˆ°å¤§å®¶é¢å‰â€”â€”è¿™å°±æ˜¯æœ¬ç« çš„ä¸»è§’**é£ä¹¦æ¨é€å™¨**ï¼Œå®ƒæ˜¯ç³»ç»Ÿçš„æœ€åä¸€é“å·¥åºï¼Œè´Ÿè´£å°†å¤„ç†å¥½çš„è®ºæ–‡æ‘˜è¦é€è¾¾é£ä¹¦ç¾¤èŠã€‚

## ä¸ºä»€ä¹ˆéœ€è¦æ¨é€å™¨ï¼Ÿ

æƒ³è±¡ä½ å¼€äº†ä¸€å®¶ç”œå“åº—ï¼š
- åå¨åšå‡ºäº†ç²¾ç¾çš„è›‹ç³•ï¼ˆè®ºæ–‡æ‘˜è¦ï¼‰
- ä½†å¦‚æœæ²¡æœ‰éª‘æ‰‹é…é€ï¼Œé¡¾å®¢æ°¸è¿œåƒä¸åˆ°

é£ä¹¦æ¨é€å™¨å°±æ˜¯æˆ‘ä»¬çš„ä¸“å±é…é€ç³»ç»Ÿï¼š
```mermaid
pie
    title ä»·å€¼æ„æˆ
    "åˆ¶ä½œå†…å®¹" : 40
    "ç¡®ä¿é€è¾¾" : 60
```

## è®¤è¯†é£ä¹¦æ¨é€å™¨

æ‰“å¼€`core/operators/sink/feishu.py`ï¼Œæ ¸å¿ƒç±»å°±åƒå¿«é€’å°å“¥çš„å·¥ä½œåŒ…ï¼š

```python
class FeishuPusher(Operator):
    """å‹¤åŠ³çš„é£ä¹¦å¿«é€’å‘˜"""
    def __init__(self, webhook_url: str):
        self.webhook_url = webhook_url  # æ”¶ä»¶åœ°å€
        self.retry_limit = 3           # æœ€å¤šå°è¯•3æ¬¡é…é€
```

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
```python
# é›‡ä¸€ä¸ªå¿«é€’å‘˜
delivery_man = FeishuPusher(
    webhook_url="https://é£ä¹¦ç¾¤æœºå™¨äººåœ°å€"
)

# å‘é€ä¸€ä»½çŸ¥è¯†åŒ…è£¹
await delivery_man.send("é‡è¦è®ºæ–‡æ¨èï¼šAIæœ€æ–°çªç ´...")
```

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. æ¶ˆæ¯å¡ç‰‡åˆ¶ä½œ
æŠŠæ‘˜è¦åŒ…è£…æˆç²¾ç¾çš„"ç¤¼å“ç›’"ï¼š
```python
def create_card(title, content):
    return {
        "msg_type": "interactive",
        "card": {
            "header": {"title": title},
            "elements": [{"tag": "div", "text": content}]
        }
    }
```

### 2. æ™ºèƒ½é‡è¯•æœºåˆ¶
é‡åˆ°ç½‘ç»œæ³¢åŠ¨æ—¶çš„è¡¨ç°ï¼š
```mermaid
sequenceDiagram
    participant ç³»ç»Ÿ as æ¨é€ç³»ç»Ÿ
    participant é£ä¹¦ as é£ä¹¦æœåŠ¡å™¨
    
    ç³»ç»Ÿ->>é£ä¹¦: ç¬¬ä¸€æ¬¡å°è¯•å‘é€
    é£ä¹¦-->>ç³»ç»Ÿ: è¶…æ—¶å¤±è´¥
    ç³»ç»Ÿ->>é£ä¹¦: ç¬¬äºŒæ¬¡å°è¯•(é—´éš”1ç§’)
    é£ä¹¦-->>ç³»ç»Ÿ: æˆåŠŸæ¥æ”¶
```

### 3. æ‰¹é‡å‘é€æ”¯æŒ
åŒæ—¶é…é€å¤šä¸ª"åŒ…è£¹"ï¼š
```python
async def batch_send(self, messages):
    tasks = [self.send(msg) for msg in messages]
    await asyncio.gather(*tasks)  # å¹¶è¡Œå‘é€
```

## å®æˆ˜æ“ä½œæŒ‡å—

### ä¸‰æ­¥å®Œæˆæ¨é€
1. **å‡†å¤‡æœºå™¨äºº**ï¼š
   - åœ¨é£ä¹¦ç¾¤æ·»åŠ "è‡ªå®šä¹‰æœºå™¨äºº"
   - è·å–webhookåœ°å€ï¼ˆç±»ä¼¼å¿«é€’æ”¶è´§åœ°å€ï¼‰

2. **æ„é€ æ¶ˆæ¯å†…å®¹**ï¼š
   ```python
   paper_card = {
       "title": "ğŸ“š æ¯æ—¥è®ºæ–‡æ¨è",
       "content": "**æ ‡é¢˜**: é‡å­è®¡ç®—æ–°çªç ´...\nAIæ€»ç»“ï¼šè¯¥ç ”ç©¶...",
       "url": "https://è®ºæ–‡é“¾æ¥"
   }
   ```

3. **æ‰§è¡Œæ¨é€**ï¼š
   ```python
   from daily_paper.core.operators import FeishuPusher

   pusher = FeishuPusher(webhook_url="ä½ çš„æœºå™¨äººåœ°å€")
   await pusher.process([paper_card])
   ```

## å†…éƒ¨å·¥ä½œæ­ç§˜

å½“è°ƒç”¨`send()`æ–¹æ³•æ—¶ï¼š
1. **å‡†å¤‡é…é€å•**ï¼šå°†æ•°æ®è½¬ä¸ºé£ä¹¦APIæ ¼å¼
   ```python
   message = {
       "msg_type": "interactive",
       "card": {
           "header": {"title": "ä»Šæ—¥ç²¾é€‰è®ºæ–‡"},
           "elements": [{"tag": "markdown", "content": "..."}]
       }
   }
   ```

2. **å‘¼å«é…é€**ï¼šé€šè¿‡HTTPå‘é€è¯·æ±‚
   ```python
   async with aiohttp.ClientSession() as session:
       async with session.post(
           self.webhook_url,
           json=message,
           timeout=10
       ) as resp:
           return resp.status == 200
   ```

3. **å¼‚å¸¸å¤„ç†**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
   ```python
   @retry(stop=stop_after_attempt(3))  # è£…é¥°å™¨å®ç°è‡ªåŠ¨é‡è¯•
   def send_with_retry(self, message):
       requests.post(self.webhook_url, json=message)
   ```

## ä¸ºä»€ä¹ˆé€‰æ‹©é£ä¹¦ï¼Ÿ

- ğŸ¢ **ä¼ä¸šçº§å¯é **ï¼šæ¶ˆæ¯å¿…è¾¾ä¿è¯
- ğŸ¨ **å¯Œåª’ä½“æ”¯æŒ**ï¼šå¯ä»¥å‘é€ç²¾ç¾å¡ç‰‡
- ğŸ¤– **ç®€å•é›†æˆ**ï¼š10åˆ†é’Ÿå³å¯æ¥å…¥æœºå™¨äºº
- ğŸ”” **å®æ—¶æé†’**ï¼šç¾¤æˆå‘˜ç«‹å³æ”¶åˆ°é€šçŸ¥

## æ€»ç»“ä¸ä¸‹ä¸€æ­¥

ä»Šå¤©æˆ‘ä»¬å­¦ä¼šäº†ï¼š
- é£ä¹¦æ¨é€å™¨æ˜¯ç³»ç»Ÿçš„"æœ€å100ç±³"
- æ”¯æŒè‡ªåŠ¨é‡è¯•ç¡®ä¿æ¶ˆæ¯å¿…è¾¾
- èƒ½å°†æ‘˜è¦åŒ…è£…æˆäº¤äº’å¼å¡ç‰‡

åœ¨ä¸‹ä¸ªç« èŠ‚ï¼Œæˆ‘ä»¬å°†è®¤è¯†ç³»ç»Ÿçš„"è®°å¿†ä¸­æ¢"â€”â€”[çŠ¶æ€ç®¡ç†å™¨](06_çŠ¶æ€ç®¡ç†å™¨_.md)ï¼Œå®ƒèƒ½è®°ä½å“ªäº›è®ºæ–‡å·²ç»å¤„ç†è¿‡ï¼Œé¿å…é‡å¤åŠ³åŠ¨ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)